<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/home_layout}"
      xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Coder'sLab</title>
    <link rel="stylesheet" th:href="@{/client_assets/css/loading.css}">
    <link rel="stylesheet" th:href="@{/client_assets/codemirror-5.65.15/lib/codemirror.css}">
    <link rel="stylesheet" th:href="@{/client_assets/codemirror-5.65.15/theme/3024-day.css}">
    <link rel="stylesheet" th:href="@{/client_assets/codemirror-5.65.15/theme/bespin.css}">
    <link rel="stylesheet" th:href="@{/client_assets/codemirror-5.65.15/theme/dracula.css}">
    <link rel="stylesheet" th:href="@{/client_assets/codemirror-5.65.15/theme/night.css}">
    <link rel="stylesheet" th:href="@{/client_assets/codemirror-5.65.15/theme/idea.css}">
    <link rel="stylesheet" th:href="@{/client_assets/codemirror-5.65.15/theme/oceanic-next.css}">
    <link rel="stylesheet" th:href="@{/admin_assets/vendor/markdown/simplemde.min.css}">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
    <script type="module" src="https://md-block.verou.me/md-block.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

    <style>
        @keyframes slide {
            0% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
            100% {
                transform: translateY(0);
            }
        }

        #loadingText {
            animation: slide 1.5s infinite;
        }

        .col {
            display: flex;
            flex-direction: column;
        }

        textarea#editor {
            width: 100%;
            flex: 1;
            padding: 0; /* Loại bỏ padding mặc định */
            margin: 0; /* Loại bỏ margin mặc định */
        }

        .course__description,
        .col {
            padding: 20px;
            overflow: auto;
            box-sizing: border-box;
            box-shadow: 0 6px 16px 0 rgba(0, 0, 0, .2);
        }

        .course__description {
            background-color: #fcfcfc;
            border-radius: 10px;
            margin-bottom: 60px;
        }

        .col {
            background-color: #fcfcfc;
            border-radius: 10px;

        }

        .d-flex {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

    </style>
</head>
<body>
<div layout:fragment="content">
    <!-- page title area start -->
    <section class="page__title-area pt-120 pb-90">
        <div class="container">
            <div class="row">
                <div>
                    <div class="course__wrapper">
                        <div class="course__tab-content mb-95">
                            <input type="hidden" id="number_of_assignments" th:value="${assignment_kit.getAssignments().size()}">
                            <input type="hidden" id="assignment_kit_id" th:value="${assignment_kit.getId()}">
                            <input type="hidden" id="user_id" th:value="${user_id}">


                            <div class="tab-content" id="courseTabContent">
                                <div class="tab-pane fade show active" id="description" role="tabpanel"
                                     aria-labelledby="description-tab">
                                    <div class="course__description" style="text-align: center">
                                        <h3 th:text="'Welcome to '+ ${assignment_kit.title} + ' Test'">
                                        </h3>
                                        <br>
                                        <div class="d-flex">
                                            <p th:text="'Test Duration: '+ ${assignment_kit.time} + ' mins'"></p>
                                            <p th:text="'Number of Question: '+ ${assignment_kit.getAssignments().size()}+ ' questions'"></p>
                                            <p th:remove="tag"
                                               th:text="'Log in as: '+ ${#authentication.principal.getUsername()}"></p>

                                        </div>
                                    </div>

                                </div>

                                <th:block th:each="assignment : ${assignment_kit.getAssignments()}">
                                    <div class="tab-pane fade" th:id="${'challenge'+assignment.id}" role="tabpanel"
                                         aria-labelledby="curriculum-tab">
                                        <div class="course__description">
                                            <h3>Mô tả yêu cầu</h3>
                                            <p th:utext="${assignment.description}"></p>
                                        </div>
                                    </div>
                                </th:block>
                                <div class="course__tab-2 mb-45">
                                    <div style="display: none">
                                        <input type="hidden" id="hidden_input" name="current_assignment">
                                    </div>
                                    <ul class="nav nav-tabs" id="courseTab" role="tablist">
                                        <li class="nav-item activebutton" role="presentation">
                                            <button onclick="changeTab(this)" class="nav-link active" id="description-tab" data-bs-toggle="tab"
                                                    data-bs-target="#description" type="button" role="tab"
                                                    aria-controls="description" aria-selected="true"><i
                                                    class="icon_ribbon_alt"></i> <span>Discription</span></button>
                                        </li>
                                        <li class="nav-item" role="presentation"
                                            th:each="assignment, itrStat  : ${assignment_kit.getAssignments()}">
                                            <button onclick="changeTab(this)" class="nav-link " th:id="${assignment.id}" data-bs-toggle="tab"
                                                    th:data-bs-target="${'#challenge'+assignment.id}" type="button" role="tab"
                                                    aria-controls="curriculum" aria-selected="false"><i
                                                    class="icon_book_alt"></i> <span
                                                    th:text="'Chanllenge 0'+${itrStat.index+1}"></span></button>
                                        </li>
                                    </ul>
                                </div>

                                <div class="col">
                                    <div style="background-color: #f3f7f7"
                                         class="d-flex justify-content-between mb-2 rounded p-2">
                                        <div>
                                            <label class="visually-hidden"
                                                   for="inlineFormSelectPref">Preference</label>
                                            <select style="cursor: pointer;" class="form-select"
                                                    id="inlineFormSelectPref">
                                                <option data-imagesrc="" selected value="cpp">C++</option>
                                                <option data-imagesrc="" value="java">Java</option>
                                                <option data-imagesrc="" value="cs">C#</option>
                                                <option data-imagesrc="" value="python">Python</option>
                                            </select>
                                        </div>
                                        <div>
                                            <!-- <label style="color: #fff;" for="theme">Theme</label> -->
                                            <select style="cursor: pointer; width: 120%;" class="form-select"
                                                    id="theme">
                                                <option selected value="Dark">Dracula</option>
                                                <option value="Light">Light</option>
                                                <option value="Night">Night</option>
                                                <option value="Idea">Idea</option>
                                                <option value="Ocenaic">Ocenaic</option>

                                            </select>
                                        </div>
                                        <button style="margin-left: 20px;cursor: pointer;background-color: #f3f7f7;color: black"
                                                type="button" id="run" class="btn btn-success">Run
                                            <i style="margin-left: 10px; font-size: 17px;"
                                               class="bx bx-play"></i></button>
                                        <button style="cursor: pointer;background-color: #00751f" type="button"
                                                id="submit" class="btn btn-success">Submit<i style="font-size: 17px;"
                                                                                             class="bx bx-play"></i></button>
                                    </div>
                                    <div style="border-color: #eee; border-style: solid; border-width: 5px;">
                                                <textarea type="text" id="editor" class="form-control"
                                                          aria-label="First name"></textarea>
                                    </div>
                                </div>

                                <section id="excuting" style="display: none"
                                         class="events__area pt-115 pb-120 p-relative">
                                    <div class="container">
                                        <div class="row">
                                            <div class="col-xxl-4 offset-xxl-4">
                                                <div class="section__title-wrapper mb-60 text-center">
                                                    <h2 class="section__title" id="loadingText">
                                                                <span style="color: #002795"
                                                                      class="yellow-bg yellow-bg-big"> đang thực thi...</span>
                                                    </h2>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                                <!-- events area start -->
                                <section id="result" style="display: none"
                                         class="events__area pt-115 pb-120 p-relative">
                                    <div class="events__shape">
                                        <img class="events-1-shape" alt="">
                                    </div>
                                    <div class="container">
                                        <div class="row" id="test-cases-container">
                                        </div>
                                    </div>
                                </section>
                                <!-- events area end -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- page title area end -->

    <script th:src="@{/client_assets/codemirror-5.65.15/lib/codemirror.js}"></script>
    <script th:src="@{/client_assets/codemirror-5.65.15/mode/clike/clike.js}"></script>
    <script th:src="@{/client_assets/codemirror-5.65.15/addon/edit/closebrackets.js}"></script>
    <script th:src="@{/client_assets/codemirror-5.65.15/mode/python/python.js}"></script>
    <script type="text/javascript" th:src="@{/client_assets/compiler/jquery-172.js}"></script>
    <script type="text/javascript" th:src="@{/client_assets/compiler/ddslick.js}"></script>
    <script th:inline="javascript">
        var editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
            mode: "text/x-c++src",
            theme: "dracula",
            lineNumbers: true,
            autoCloseBrackets: true,
        })
        var width = window.innerWidth
        editor.setSize("initial", "")
        var option;
        var langague_name;
        $("#inlineFormSelectPref").ddslick({
            onSelected: function (selectedData) {
                if (selectedData.selectedData.value === "cpp") {
                    editor.setOption("mode", "text/x-c++src")
                    editor.setOption("value", "#include<iostream>\n\nint main() {\n  std::cout << \"Hello world!\";\n\n  return 0;\n}")
                    option = 54;
                    langague_name = 'C++';
                }
                if (selectedData.selectedData.value === "java") {
                    editor.setOption("mode", "text/x-java")
                    editor.setOption("value", 'import java.util.*;\nimport java.io.*;\n\npublic class Main {\n    public static void main(String[] args) {\n      System.out.println(\"Hello world!\");\n    }\n}')
                    option = 91;
                    langague_name = 'java';
                }
                if (selectedData.selectedData.value === "cs") {
                    editor.setOption("mode", "text/x-csharp");
                    editor.setValue("using System;\n\nclass Program {\n   static void Main() {\n     Console.WriteLine(\"Hello world!\");\n   }\n}");
                    option = 51;
                    langague_name = 'C#';
                }
                if (selectedData.selectedData.value === "python") {
                    editor.setOption("mode", "text/x-python")
                    editor.setOption("value", "print('Hello world!')")
                    option = 71;
                    langague_name ='python';
                }
            }
        });
        function changeTab(element) {
            var currentTab = document.querySelector('.nav-item.activebutton');
            var nextTab = currentTab.nextElementSibling;
            nextTab.classList.add("activebutton");
            currentTab.classList.remove("activebutton");

            if (editor.getValue()!="#include<iostream>\n\nint main() {\n  std::cout << \"Hello world!\";\n\n  return 0;\n}") {
                if (confirm('Next tab without saving?')) {
                    editor.setOption("mode", "text/x-c++src")
                    editor.setValue("#include<iostream>\n\nint main() {\n  std::cout << \"Hello world!\";\n\n  return 0;\n}")
                    option = 54;
                    langague_name = 'C++';
                }
            }
            const inputElement = document.getElementById('hidden_input');
            inputElement.value = element.getAttribute("id");
        }

    </script>

    <script type="module" th:src="@{/client_assets/compiler/certify.js}"></script>
</div>
</body>
</html>